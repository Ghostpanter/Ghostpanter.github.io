<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>流水易寒の博客</title><meta name="author" content="姬岚忧"><meta name="copyright" content="姬岚忧"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="不想做开发的运维，不是好运维"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202212290947085.png"><link rel="canonical" href="https://blog.kkun.site/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="zEdV2SVm14BBjmysMbimJptVuSESoCKhQvg2KGyh3tM"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-5936787105308700',
  enable_page_level_ads: 'true'
});</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-RRJTLY81FN"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-RRJTLY81FN');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '流水易寒の博客',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-08-28 10:34:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/logo.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">77</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">43</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">39</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 文章目录</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://github.com/Ghostpanter"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202212290952165.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">流水易寒の博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 文章目录</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://github.com/Ghostpanter"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">流水易寒の博客</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/Ghostpanter" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:18816230062qk@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2023/08/28/%E4%BD%BF%E7%94%A8%20OpenTelemetry%20Collector%20%E6%94%B6%E9%9B%86%20Kubernetes%20%E6%97%A5%E5%BF%97%E6%95%B0%E6%8D%AE/" title="使用 OpenTelemetry Collector 收集 Kubernetes 日志数据"><img class="post_bg" src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202308280847173.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 OpenTelemetry Collector 收集 Kubernetes 日志数据"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/08/28/%E4%BD%BF%E7%94%A8%20OpenTelemetry%20Collector%20%E6%94%B6%E9%9B%86%20Kubernetes%20%E6%97%A5%E5%BF%97%E6%95%B0%E6%8D%AE/" title="使用 OpenTelemetry Collector 收集 Kubernetes 日志数据">使用 OpenTelemetry Collector 收集 Kubernetes 日志数据</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-28T02:52:55.000Z" title="发表于 2023-08-28 10:52:55">2023-08-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/kubernetes/OpenTelemetry-Collector/">OpenTelemetry Collector</a></span></div><div class="content">前面我们介绍了如何通过 OpenTelemetry Collector 来收集 Kubernetes 集群的指标数据，接下来我们再来了解下如何收集集群的日志记录数据。

安装 Loki首先我们需要部署 Loki 来收集日志数据，同样我们这里使用 Helm Chart 来快速部署，不过需要注意同样不需要部署任何日志采集器，因为我们将使用 OpenTelemetry Collector 来收集日志数据，然后再将其发送到 Loki 中。
12helm repo add grafana https://grafana.github.io/helm-charthelm repo update

我们这里创建一个 loki-values.yaml 文件来配置 Loki Helm Chart：
12345678910111213141516171819202122232425262728293031# loki-values.yamlloki:  commonConfig:    replication_factor: 1  auth_enabled: false  storage:    type ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/08/28/%E4%BD%BF%E7%94%A8OpenTelemetry%20Collector%E9%87%87%E9%9B%86Kubernetes%E6%8C%87%E6%A0%87%E6%95%B0%E6%8D%AE/" title="使用 OpenTelemetry Collector 采集 Kubernetes 指标数据"><img class="post_bg" src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202308280933314.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 OpenTelemetry Collector 采集 Kubernetes 指标数据"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/08/28/%E4%BD%BF%E7%94%A8OpenTelemetry%20Collector%E9%87%87%E9%9B%86Kubernetes%E6%8C%87%E6%A0%87%E6%95%B0%E6%8D%AE/" title="使用 OpenTelemetry Collector 采集 Kubernetes 指标数据">使用 OpenTelemetry Collector 采集 Kubernetes 指标数据</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-28T01:52:55.000Z" title="发表于 2023-08-28 09:52:55">2023-08-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/kubernetes/OpenTelemetry-Collector/">OpenTelemetry Collector</a></span></div><div class="content">
Kubernetes 已成为一个被广泛采用的行业工具，对可观测性工具的需求也在不断增加。为此，OpenTelemetry 创建了许多不同的工具，来帮助 Kubernetes 用户观察他们的集群和服务。
接下来我们将开始使用 OpenTelemetry 监控 Kubernetes 集群，将专注于收集 Kubernetes 集群、节点、pod 和容器的指标和日志，并使集群能够支持发出 OTLP 数据的服务。
Kubernetes 以多种不同的方式暴露了许多重要的遥测数据。它具有用于许多不同对象的日志、事件和指标，以及其工作负载生成的数据。 为了收集这些数据，我们将使用 OpenTelemetry Collector。该收集器可以高效地收集所有这些数据。
为了收集所有的数据，我们将需要安装两个收集器，一个作为 Daemonset，一个作为 Deployment。收集器的 DaemonSet 将用于收集服务、日志和节点、Pod 和容器的指标，而 Deployment 将用于收集集群的指标和事件。
为了安装收集器，我们这里将使用 OpenTelemetry Collector Helm 图表( ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/08/24/Ubuntu%20apt%E6%BA%90%E5%AF%86%E9%92%A5%E4%B8%8D%E5%8F%AF%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="Ubuntu apt源密钥不可用解决方案"><img class="post_bg" src="https://tenapi.cn/acg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ubuntu apt源密钥不可用解决方案"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/08/24/Ubuntu%20apt%E6%BA%90%E5%AF%86%E9%92%A5%E4%B8%8D%E5%8F%AF%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="Ubuntu apt源密钥不可用解决方案">Ubuntu apt源密钥不可用解决方案</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-24T00:03:51.000Z" title="发表于 2023-08-24 08:03:51">2023-08-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Linux/">Linux</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Linux/Ubuntu/">Ubuntu</a></span></div><div class="content">现象
报错如下

1The following signatures couldn&#x27;t be verified because the public key is not available: NO_PUBKEY D8FF8E1F7DF8B07E


apt update报错

1234W: GPG error: https://repos.influxdata.com/ubuntu focal InRelease: The following signatures couldn&#x27;t be verified because the public key is not available: NO_PUBKEY D8FF8E1F7DF8B07EE: The repository &#x27;https://repos.influxdata.com/ubuntu focal InRelease&#x27; is not signed.N: Updating from such a repository can&#x27;t be done securely, and is ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/08/23/%E4%BD%BF%E7%94%A8helm%E5%AE%89%E8%A3%85NFS-Client%20Provisioner%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8/" title="使用helm安装NFS-Client Provisioner实现动态存储"><img class="post_bg" src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/84596624_p0.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用helm安装NFS-Client Provisioner实现动态存储"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/08/23/%E4%BD%BF%E7%94%A8helm%E5%AE%89%E8%A3%85NFS-Client%20Provisioner%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8/" title="使用helm安装NFS-Client Provisioner实现动态存储">使用helm安装NFS-Client Provisioner实现动态存储</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-23T06:22:51.000Z" title="发表于 2023-08-23 14:22:51">2023-08-23</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/kubernetes/NFS/">NFS</a></span></div><div class="content">本文介绍使用helm安装NFS-Client Provisioner实现动态存储，主要包括使用helm安装NFS-Client Provisioner实现动态存储使用实例、应用技巧、基本知识点总结和需要注意事项，具有一定的参考价值，需要的朋友可以参考一下。

准备
1.1 搭建好NFS服务
1.2 安装好helm

helm安装地址


安装


1234567891011#添加helm源helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner#直接安装(10.1.129.86为NFS地址，/data/nfs-ops为共享的目录)helm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \    --set nfs.server=10.1.129.86 \    - ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/08/16/linux%E5%8A%A0%E5%9B%BA%E8%84%9A%E6%9C%AC/" title="Linux加固脚本"><img class="post_bg" src="https://air.moe/ranimg/api.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux加固脚本"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/08/16/linux%E5%8A%A0%E5%9B%BA%E8%84%9A%E6%9C%AC/" title="Linux加固脚本">Linux加固脚本</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-16T00:03:51.000Z" title="发表于 2023-08-16 08:03:51">2023-08-16</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Linux/">Linux</a></span></div><div class="content">12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210310410510610710810911011111211311411511611711811912012112212312412512612712812913013113213313413513613713813914014114214314414514614714814915015115215315415515615715815916016116216316416516616716816917017117217317417517617717817918018118218318418518618718818919019119219319419519619719819920020120220 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/08/15/%E5%9C%A8kubernetes%E4%B8%AD%E9%83%A8%E7%BD%B2rookceph/" title="在kubernetes中部署rookCeph"><img class="post_bg" src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202301101629307.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在kubernetes中部署rookCeph"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/08/15/%E5%9C%A8kubernetes%E4%B8%AD%E9%83%A8%E7%BD%B2rookceph/" title="在kubernetes中部署rookCeph">在kubernetes中部署rookCeph</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-15T00:54:38.000Z" title="发表于 2023-08-15 08:54:38">2023-08-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ceph/">Ceph</a></span></div><div class="content">安装CRD资源1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/08/01/K8s%20Pod%20IP%20%E5%88%86%E9%85%8D%E6%9C%BA%E5%88%B6/" title="K8s Pod IP 分配机制"><img class="post_bg" src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202301101650972.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8s Pod IP 分配机制"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/08/01/K8s%20Pod%20IP%20%E5%88%86%E9%85%8D%E6%9C%BA%E5%88%B6/" title="K8s Pod IP 分配机制">K8s Pod IP 分配机制</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-01T09:03:33.000Z" title="发表于 2023-08-01 17:03:33">2023-08-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span></div><div class="content">概述Pod 作为 K8s 中一等公民，其承载了最核心的 Container(s) 的运行。同时，Pod 也是 K8s 中资源调度的最小单位，因此熟悉其初始化过程（包括网络、存储、运行时等）将会使我们更加深入理解 K8s 的容器编排原理，以期更好的服务各类业务。
Pod 初始化核心流程如下：

kube-apiserver 收到客户端请求（Controller 或 kubectl 客户端）后，创建对应的 Pod；
kube-scheduler 按照配置的调度策略进行 Pod 调度，选择最为合适的 Node 作为目标节点；
kubelet（运行于每个 Node 上的 K8s agent）Watch 监听到调度到所在节点的 Pod(s)，开始真正创建 Pod；
由 CRI 首先创建出 PodSandbox，初始化对应的网络 net namespace，调用 CNI 获取 Pod IP；
接着 CRI 开始创建 Pod 中第一个 pause container，绑定到上一步创建的 net namespace 和 Pod IP；
接着由 CRI 依次创建和启动 Pod 中声明的 initCont ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/07/28/Kubernetes%20Pod%20%E4%B8%AD%E5%AE%B9%E5%99%A8%E7%9A%84%E5%90%AF%E5%8A%A8%E4%BC%98%E5%85%88%E7%BA%A7/" title="Kubernetes Pod 中容器的启动优先级"><img class="post_bg" src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202301051003635.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes Pod 中容器的启动优先级"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/07/28/Kubernetes%20Pod%20%E4%B8%AD%E5%AE%B9%E5%99%A8%E7%9A%84%E5%90%AF%E5%8A%A8%E4%BC%98%E5%85%88%E7%BA%A7/" title="Kubernetes Pod 中容器的启动优先级">Kubernetes Pod 中容器的启动优先级</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-28T09:54:33.000Z" title="发表于 2023-07-28 17:54:33">2023-07-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span></div><div class="content">
今天分享的主题是：怎么控制 Kubernetes 单个 Pod 中容器的启动顺序。
在前面讲容器设计模式时，我曾提到过 Kubernetes Pod 內有两种容器，分别是

Init Container（初始化容器）：在 spec.initContainers 结构体內
Application Container（应用容器）：在 spec.containers 结构体內

Init ContainerInit Container 执行优先于 Application Container，且会按照顺序逐一执行，每个 Init Container 成功终止退出后，下一个 Init Container 才开始执行。
Application Container但是 Application Container 则是完全不一样的，数组內的容器之间是平等无序的。什么意思呢？就是说它们会并行运行，所以我们部署服务时绝不能对容器的顺序做出假设。
我们先来看一个完整的 Pod 的 YMAL 结构，如下所示，全部使用一样的镜像地址：
1234567891011121314151617181920212223 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/07/28/Kubernetes%201.27%E5%8E%9F%E5%9C%B0%E8%B0%83%E6%95%B4%20Pod%20%E8%B5%84%E6%BA%90%20(alpha)/" title="Kubernetes 1.27 原地调整 Pod 资源 (alpha)"><img class="post_bg" src="https://imgapi.xl0408.top/index.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes 1.27 原地调整 Pod 资源 (alpha)"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/07/28/Kubernetes%201.27%E5%8E%9F%E5%9C%B0%E8%B0%83%E6%95%B4%20Pod%20%E8%B5%84%E6%BA%90%20(alpha)/" title="Kubernetes 1.27 原地调整 Pod 资源 (alpha)">Kubernetes 1.27 原地调整 Pod 资源 (alpha)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-28T09:40:33.000Z" title="发表于 2023-07-28 17:40:33">2023-07-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span></div><div class="content">
如果你部署的 Pod 设置了 CPU 或内存资源，你就可能已经注意到更改资源值会导致 Pod 重新启动。以前，这对于运行的负载来说是一个破坏性的操作。
在 Kubernetes v1.27 中，我们添加了一个新的 alpha 特性，允许用户调整分配给 Pod 的 CPU 和内存资源大小，而无需重新启动容器。首先，API 层面现在允许修改 Pod 容器中的 resources 字段下的 CPU 和 memory 资源。资源修改只需 patch 正在运行的 Pod 规约即可。
这也意味着 Pod 定义中的 resource 字段不能再被视为 Pod 实际资源的指标。监控程序必须 查看 Pod 状态中的新字段来获取实际资源状况。Kubernetes 通过 CRI（Container Runtime Interface，容器运行时接口）API 调用运行时（例如 containerd）来查询实际的 CPU 和内存 的请求和限制。容器运行时的响应会反映在 Pod 的状态中。
此外，Pod 中还添加了对应于资源调整的新字段 restartPolicy。这个字段使用户可以控制在资源调整时容器的行为。 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/07/28/%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86Docker%E5%AE%B9%E5%99%A8%E5%92%8CKubernetes%20Pod%E7%9A%84DNS/" title="如何管理 Docker 容器和 Kubernetes Pod 的 DNS"><img class="post_bg" src="https://air.moe/ranimg/api.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何管理 Docker 容器和 Kubernetes Pod 的 DNS"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/07/28/%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86Docker%E5%AE%B9%E5%99%A8%E5%92%8CKubernetes%20Pod%E7%9A%84DNS/" title="如何管理 Docker 容器和 Kubernetes Pod 的 DNS">如何管理 Docker 容器和 Kubernetes Pod 的 DNS</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-28T03:40:33.000Z" title="发表于 2023-07-28 11:40:33">2023-07-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/kubernetes/">kubernetes</a></span></div><div class="content">DNS简介DNS服务是域名系统的缩写， 英文全称：Domain Name System，将域名和IP地址相互映射。在容器环境中，DNS至关重要，例如在Kubernetes集群中，通常一组Pod由一个Service负载，但是Service的IP地址有可能需要变动，那么就可以让Pod通过域名的方式去访问Service，Pod无需理会IP地址的变化。
Docker DNSDocker linkDocker link是一个遗留的特性，在新版本的Docker中，一般不推荐使用。简单来说Docker link就是把两个容器连接起来，容器可以使用容器名进行通信，而不需要依赖ip地址（其实就是在容器的&#x2F;etc&#x2F;hosts文件添加了host记录，原本容器之间的IP就是通的，只是我们增加了host记录，可以不用IP去访问）
创建容器centos-1：
1[root@host1 ~]# docker run -itd --name centos-1  registry.cn-shanghai.aliyuncs.com/public-namespace/cr7-centos7-tool:v ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/#content-inner">8</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">姬岚忧</div><div class="author-info__description">不想做开发的运维，不是好运维</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">77</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">43</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">39</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Ghostpanter"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Ghostpanter" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:18816230062qk@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/08/28/%E4%BD%BF%E7%94%A8%20OpenTelemetry%20Collector%20%E6%94%B6%E9%9B%86%20Kubernetes%20%E6%97%A5%E5%BF%97%E6%95%B0%E6%8D%AE/" title="使用 OpenTelemetry Collector 收集 Kubernetes 日志数据"><img src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202308280847173.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 OpenTelemetry Collector 收集 Kubernetes 日志数据"/></a><div class="content"><a class="title" href="/2023/08/28/%E4%BD%BF%E7%94%A8%20OpenTelemetry%20Collector%20%E6%94%B6%E9%9B%86%20Kubernetes%20%E6%97%A5%E5%BF%97%E6%95%B0%E6%8D%AE/" title="使用 OpenTelemetry Collector 收集 Kubernetes 日志数据">使用 OpenTelemetry Collector 收集 Kubernetes 日志数据</a><time datetime="2023-08-28T02:52:55.000Z" title="发表于 2023-08-28 10:52:55">2023-08-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/28/%E4%BD%BF%E7%94%A8OpenTelemetry%20Collector%E9%87%87%E9%9B%86Kubernetes%E6%8C%87%E6%A0%87%E6%95%B0%E6%8D%AE/" title="使用 OpenTelemetry Collector 采集 Kubernetes 指标数据"><img src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202308280933314.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 OpenTelemetry Collector 采集 Kubernetes 指标数据"/></a><div class="content"><a class="title" href="/2023/08/28/%E4%BD%BF%E7%94%A8OpenTelemetry%20Collector%E9%87%87%E9%9B%86Kubernetes%E6%8C%87%E6%A0%87%E6%95%B0%E6%8D%AE/" title="使用 OpenTelemetry Collector 采集 Kubernetes 指标数据">使用 OpenTelemetry Collector 采集 Kubernetes 指标数据</a><time datetime="2023-08-28T01:52:55.000Z" title="发表于 2023-08-28 09:52:55">2023-08-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/24/Ubuntu%20apt%E6%BA%90%E5%AF%86%E9%92%A5%E4%B8%8D%E5%8F%AF%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="Ubuntu apt源密钥不可用解决方案"><img src="https://tenapi.cn/acg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ubuntu apt源密钥不可用解决方案"/></a><div class="content"><a class="title" href="/2023/08/24/Ubuntu%20apt%E6%BA%90%E5%AF%86%E9%92%A5%E4%B8%8D%E5%8F%AF%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="Ubuntu apt源密钥不可用解决方案">Ubuntu apt源密钥不可用解决方案</a><time datetime="2023-08-24T00:03:51.000Z" title="发表于 2023-08-24 08:03:51">2023-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/23/%E4%BD%BF%E7%94%A8helm%E5%AE%89%E8%A3%85NFS-Client%20Provisioner%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8/" title="使用helm安装NFS-Client Provisioner实现动态存储"><img src="https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/84596624_p0.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用helm安装NFS-Client Provisioner实现动态存储"/></a><div class="content"><a class="title" href="/2023/08/23/%E4%BD%BF%E7%94%A8helm%E5%AE%89%E8%A3%85NFS-Client%20Provisioner%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8/" title="使用helm安装NFS-Client Provisioner实现动态存储">使用helm安装NFS-Client Provisioner实现动态存储</a><time datetime="2023-08-23T06:22:51.000Z" title="发表于 2023-08-23 14:22:51">2023-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/16/linux%E5%8A%A0%E5%9B%BA%E8%84%9A%E6%9C%AC/" title="Linux加固脚本"><img src="https://air.moe/ranimg/api.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux加固脚本"/></a><div class="content"><a class="title" href="/2023/08/16/linux%E5%8A%A0%E5%9B%BA%E8%84%9A%E6%9C%AC/" title="Linux加固脚本">Linux加固脚本</a><time datetime="2023-08-16T00:03:51.000Z" title="发表于 2023-08-16 08:03:51">2023-08-16</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Ansible/"><span class="card-category-list-name">Ansible</span><span class="card-category-list-count">2</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Ansible/playbook/"><span class="card-category-list-name">playbook</span><span class="card-category-list-count">1</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Ceph/"><span class="card-category-list-name">Ceph</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CubeFS/"><span class="card-category-list-name">CubeFS</span><span class="card-category-list-count">1</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CubeFS/ClickHouse/"><span class="card-category-list-name">ClickHouse</span><span class="card-category-list-count">1</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Docker/"><span class="card-category-list-name">Docker</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Linux/"><span class="card-category-list-name">Linux</span><span class="card-category-list-count">11</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Linux/DNS/"><span class="card-category-list-name">DNS</span><span class="card-category-list-count">1</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Ansible/" style="font-size: 1.24em; color: rgb(69, 32, 35)">Ansible</a><a href="/tags/playbook/" style="font-size: 1.15em; color: rgb(140, 104, 182)">playbook</a><a href="/tags/kubernetes/" style="font-size: 1.45em; color: rgb(192, 119, 7)">kubernetes</a><a href="/tags/CGroups/" style="font-size: 1.15em; color: rgb(66, 161, 197)">CGroups</a><a href="/tags/CICD/" style="font-size: 1.19em; color: rgb(31, 36, 197)">CICD</a><a href="/tags/Gitlab/" style="font-size: 1.15em; color: rgb(107, 83, 188)">Gitlab</a><a href="/tags/Ceph/" style="font-size: 1.32em; color: rgb(89, 33, 73)">Ceph</a><a href="/tags/CubeFS/" style="font-size: 1.15em; color: rgb(190, 135, 38)">CubeFS</a><a href="/tags/ClickHouse/" style="font-size: 1.15em; color: rgb(189, 48, 136)">ClickHouse</a><a href="/tags/CoreDns/" style="font-size: 1.15em; color: rgb(114, 57, 120)">CoreDns</a><a href="/tags/etcd/" style="font-size: 1.19em; color: rgb(156, 189, 61)">etcd</a><a href="/tags/Linux/" style="font-size: 1.41em; color: rgb(80, 74, 167)">Linux</a><a href="/tags/Jenkins/" style="font-size: 1.15em; color: rgb(14, 55, 187)">Jenkins</a><a href="/tags/Grafana/" style="font-size: 1.28em; color: rgb(151, 189, 7)">Grafana</a><a href="/tags/Tempo/" style="font-size: 1.19em; color: rgb(0, 9, 133)">Tempo</a><a href="/tags/Docker/" style="font-size: 1.36em; color: rgb(143, 106, 110)">Docker</a><a href="/tags/OpenKruise/" style="font-size: 1.28em; color: rgb(110, 36, 109)">OpenKruise</a><a href="/tags/MAC/" style="font-size: 1.15em; color: rgb(190, 34, 193)">MAC</a><a href="/tags/OpenCore/" style="font-size: 1.15em; color: rgb(188, 6, 65)">OpenCore</a><a href="/tags/Prometheus/" style="font-size: 1.15em; color: rgb(168, 10, 139)">Prometheus</a><a href="/tags/Ubuntu/" style="font-size: 1.15em; color: rgb(120, 59, 169)">Ubuntu</a><a href="/tags/Helm/" style="font-size: 1.19em; color: rgb(24, 44, 12)">Helm</a><a href="/tags/Harbor/" style="font-size: 1.24em; color: rgb(0, 123, 163)">Harbor</a><a href="/tags/Minio/" style="font-size: 1.19em; color: rgb(70, 30, 76)">Minio</a><a href="/tags/NFS/" style="font-size: 1.24em; color: rgb(199, 35, 137)">NFS</a><a href="/tags/ingress/" style="font-size: 1.19em; color: rgb(60, 24, 39)">ingress</a><a href="/tags/kubectl/" style="font-size: 1.15em; color: rgb(166, 73, 128)">kubectl</a><a href="/tags/Kubelet/" style="font-size: 1.24em; color: rgb(180, 142, 33)">Kubelet</a><a href="/tags/Nginx/" style="font-size: 1.15em; color: rgb(172, 73, 81)">Nginx</a><a href="/tags/PDNS/" style="font-size: 1.15em; color: rgb(34, 199, 42)">PDNS</a><a href="/tags/PVE/" style="font-size: 1.15em; color: rgb(110, 63, 28)">PVE</a><a href="/tags/containerd/" style="font-size: 1.15em; color: rgb(116, 77, 30)">containerd</a><a href="/tags/GO/" style="font-size: 1.15em; color: rgb(68, 6, 50)">GO</a><a href="/tags/Kaniko/" style="font-size: 1.15em; color: rgb(91, 90, 15)">Kaniko</a><a href="/tags/OpenTelemetry-Collector/" style="font-size: 1.19em; color: rgb(196, 194, 100)">OpenTelemetry Collector</a><a href="/tags/Cilium/" style="font-size: 1.15em; color: rgb(188, 174, 35)">Cilium</a><a href="/tags/Kind/" style="font-size: 1.15em; color: rgb(78, 197, 33)">Kind</a><a href="/tags/opentracing/" style="font-size: 1.15em; color: rgb(124, 182, 185)">opentracing</a><a href="/tags/Mysql/" style="font-size: 1.15em; color: rgb(50, 76, 57)">Mysql</a><a href="/tags/Loki/" style="font-size: 1.19em; color: rgb(124, 199, 106)">Loki</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">七月 2023</span><span class="card-archive-list-count">13</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><span class="card-archive-list-count">10</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><span class="card-archive-list-count">9</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><span class="card-archive-list-count">18</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><span class="card-archive-list-count">15</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">77</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2022-12-27T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">335.2k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-08-28T02:34:09.388Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/Ghostpanter/tuchuang/img/202212290952165.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 姬岚忧</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div><div class="aplayer no-destroy" data-id="8017562763" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '119.60681,31.99260';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>